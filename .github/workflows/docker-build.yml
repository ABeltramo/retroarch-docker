name: docker_build

on:
  push:
  pull_request: #They will only build the containers, not push them
    types:
    - opened
    - reopened
  schedule:
  - cron: "0 0 * * *" #nightly
  workflow_dispatch:

jobs:
  base:
    uses: zb140/gow/.github/workflows/docker-build-and-publish.yml@refactor
    with:
      image_name: "base"
    secrets: inherit

  base-x11:
    needs: [ base ]
    uses: zb140/gow/.github/workflows/docker-build-and-publish.yml@refactor
    with:
      image_name: "base-x11"
    secrets: inherit

  apps:
    needs: [ base, base-x11 ]
    strategy:
      matrix:
        image:
        - { name: xorg,       platforms: "linux/amd64,linux/arm64" }
        - { name: pulseaudio, platforms: "linux/amd64,linux/arm64" }
        - { name: udevd,      platforms: "linux/amd64,linux/arm64" }
        - { name: sunshine,   platforms: "linux/amd64" }
        - { name: retroarch,  platforms: "linux/amd64,linux/arm64" }
        - { name: steam,      platforms: "linux/amd64"             }
      fail-fast: false
    uses: zb140/gow/.github/workflows/docker-build-and-publish.yml@refactor
    with:
      image_name: "${{ matrix.image.name }}"
      platforms: "${{ matrix.image.platforms }}"
    secrets: inherit

